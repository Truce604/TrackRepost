<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Repost Campaigns - TrackRepost</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="/js/firebaseConfig.js"></script>
  <script>
    firebase.initializeApp(window.firebaseConfig);
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #2a2a2a; /* Darker, subtle background */
      color: white;
      text-align: center;
      padding: 20px 0;
    }

    h1 {
      font-size: 36px;
      margin: 0;
    }

    .container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .track-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }

    .track-item {
      border: 1px solid #ddd;
      padding: 20px;
      margin: 10px 0;
      width: 80%;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    iframe {
      width: 100%;
      height: 166px;
      border-radius: 10px;
    }

    .track-actions {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }

    .track-actions label {
      margin: 5px;
      font-size: 16px;
      color: #555;
    }

    .credits-info {
      font-weight: bold;
      color: #4caf50;
      margin-top: 10px;
      font-size: 18px;
    }

    .status-message {
      color: #f44336;
      font-weight: bold;
      margin-top: 20px;
    }

    button {
      background-color: #4caf50; /* Changed to a more calming green */
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }

    button:hover {
      background-color: #45a049; /* Slightly darker green */
    }

    footer {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 10px 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    <h1>üé∂ Available Tracks to Repost</h1>
  </header>
  <main class="container">
    <div id="track-list"></div>
  </main>

  <footer>
    <p>¬© 2025 TrackRepost. All Rights Reserved.</p>
  </footer>

  <script>
    const db = firebase.firestore();
    const trackListContainer = document.getElementById('track-list');

    async function loadCampaigns() {
      const campaignsSnap = await db.collection('campaigns').get();
      campaignsSnap.forEach(doc => {
        const trackData = doc.data();
        buildTrackUI(trackData);
      });
    }

    function buildTrackUI(trackData) {
      const trackElement = document.createElement('div');
      trackElement.classList.add('track-item');

      trackElement.innerHTML = `
        <h2>${trackData.genre} ‚Äì ${trackData.artist}</h2>
        <iframe src="https://w.soundcloud.com/player/?url=${encodeURIComponent(trackData.trackUrl)}&color=%23ff5500&inverse=false&auto_play=false&show_user=true" frameborder="no" scrolling="no"></iframe>
        <div class="track-actions">
          <label><input type="checkbox" id="like-${trackData.id}" checked /> üíñ Like this track (+1 credit)</label>
          <label><input type="checkbox" id="follow-${trackData.id}" /> üë£ Follow the artist (+2 credits)</label>
          <label><input type="checkbox" id="comment-${trackData.id}" /> üí¨ Leave a comment (+2 credits)</label>
          <textarea id="comment-text-${trackData.id}" placeholder="Enter your comment here..." style="width: 100%; height: 50px;"></textarea>
          <button onclick="repostTrack('${trackData.id}', '${trackData.trackUrl}')">‚úÖ Repost & Earn Credits</button>
        </div>
        <div class="credits-info" id="credits-${trackData.id}">Credits: ${trackData.credits}</div>
        <div id="status-${trackData.id}" class="status-message"></div>
      `;

      trackListContainer.appendChild(trackElement);
    }

    async function repostTrack(trackId, trackUrl) {
      const user = firebase.auth().currentUser;
      const status = document.getElementById(`status-${trackId}`);
      if (!user) {
        status.textContent = "‚ùå You must be logged in to repost.";
        return;
      }

      const like = document.getElementById(`like-${trackId}`).checked;
      const follow = document.getElementById(`follow-${trackId}`).checked;
      const comment = document.getElementById(`comment-${trackId}`).checked;
      const commentText = document.getElementById(`comment-text-${trackId}`).value;

      let credits = 0;
      if (like) credits += 1;
      if (follow) credits += 2;
      if (comment) credits += 2;

      const userRef = db.collection('users').doc(user.uid);
      const userSnap = await userRef.get();
      const userData = userSnap.data();

      if (userData.credits < credits) {
        status.textContent = "‚ùå You don't have enough credits to repost.";
        return;
      }

      // Deduct credits from user and add repost to campaign
      await userRef.update({
        credits: userData.credits - credits
      });

      const campaignRef = db.collection('campaigns').doc(trackId);
      const campaignSnap = await campaignRef.get();
      const campaignData = campaignSnap.data();
      await campaignRef.update({
        credits: campaignData.credits - credits
      });

      await db.collection('reposts').add({
        userId: user.uid,
        trackUrl,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        creditsEarned: credits,
        commentText
      });

      status.textContent = `‚úÖ Reposted! You earned ${credits} credits.`;
    }

    loadCampaigns();
  </script>
</body>
</html>



